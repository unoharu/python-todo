# Copilot Instructions

## 開発者プロフィール
日本人のソロ開発者。シニアレベルの品質基準で作業する。Python、TypeScript、Webプロジェクトを横断して開発している。

## 言語
- 回答・説明は日本語で行う
- コード・変数名・コメントは英語
- アプリのユーザー向け文字列はそのプロジェクトの言語に従う

---

## プロジェクト情報（python-todo）

**概要:** Flask ベースの個人日記アプリ（シングルユーザー、ローカル利用）。MySQL + JSON から SQLite への移行リファクタリング中。

**スタック:** Python 3.x, Flask 3.x, SQLite, Jinja2

**目標ファイル構成:**
```
app/
├── __init__.py       # create_app()
├── config.py         # 環境別設定
├── models/           # User, DiaryEntry
├── routes/           # auth.py, diary.py（HTTP のみ）
├── services/         # auth_service.py, diary_service.py（ビジネスロジック）
└── db.py             # SQLite 接続
tests/
├── conftest.py       # fixtures（インメモリ DB）
├── test_auth.py
└── test_diary.py
run.py                # エントリポイント
```

**技術的負債（未修正）:**
- パスワードが SHA256 + ソルトなし → `werkzeug.security` に移行必須
- `SECRET_KEY` と DB 接続がハードコード → `.env` で管理
- CSRF 保護なし・入力バリデーションなし

---

## コーディング原則

### プログラミング原則
- **DRY**: 重複を排除。同じロジックは1箇所にのみ存在する
- **KISS**: シンプルを優先。複雑な解決策より理解しやすい実装を選ぶ
- **YAGNI**: 今必要なものだけ実装する。将来のための予防的コードは書かない
- **単一責任**: 各関数・クラスは1つのことだけを担当する
- **早期失敗**: エラーは境界で即座に表面化させる。サイレントに伝播させない

### 品質の絶対原則
- エラーを抑制しない（`@ts-ignore`, `bare except`, 例外の握りつぶし）
- 外部 I/O（ネットワーク・ファイルシステム・DB）は必ずエラー処理を入れる
- 未使用コードはコメントアウトではなく削除する
- シークレットのハードコード禁止・外部入力は必ずバリデート・最小権限の原則

### コードを書くとき
- 根本原因を探る。一時的なパッチは禁止
- 名前はメカニズムではなく意図を伝えるものにする
- コメントは「なぜ」を説明する。「何を」はコードで表現する
- 振る舞いを変えない変更（リファクタリング）と機能追加は分けて考える

---

## コード提案のガイドライン

### インライン補完
- 最小限の変更でタスクを達成するコードを提案する
- 既存のコードスタイル・命名規則に合わせる
- 型アノテーションを含める（Python: type hints, TS: 明示的な型）
- `services/` のビジネスロジックは Flask に依存しないように書く

### コードレビュー・提案の優先度
1. **Blockers**: 正確さ・セキュリティ（必ず指摘）
2. **Should Fix**: 堅牢性・設計（強く推奨）
3. **Nice to Have**: 可読性（任意）

### テスト
- 振る舞いをテストする（実装詳細ではなく）
- テストは独立して任意の順序で実行可能に
- `conftest.py` にインメモリ SQLite DB の fixture を用意する

---

## Git 規約
- Conventional Commits: `feat:`, `fix:`, `docs:`, `test:`, `refactor:`, `chore:`
- コミットメッセージは英語・命令形
- 1コミット = 1つの論理的な変更

---

## 出力フォーマット
- 前置きより先に答えや変更内容を示す
- コードは差分・新規コードのみ（変更していない周辺コードは不要）
- 挨拶・感嘆表現は使わない
- 絵文字はユーザーが明示的に要求した場合のみ使用する
